import generalData from '../utils/general-data';
import getIdFromUrl from '../utils/get-id-from-url';
import { BlinkEvent } from '../types';
import { Page } from '../selectors/get-page-state';

export interface PreparePageLoadInput {
  page: Page;
  url: string;
}

export default function preparePageloadEvent({
  page,
  url,
}: PreparePageLoadInput): BlinkEvent {
  const id = getIdFromUrl(url, page.state.general.site);
  return {
    ...generalData(page.state),
    abCookie: page.state.general.abCookie,
    commercialSegments: page.state.general.commercialSegments,
    article: { harvesterId: id, url },
    clientHeight: page.state.general.clientHeight,
    clientWidth: page.state.general.clientWidth,
    id: id || '',
    pageType: page.state.general.pageType,
    plussData: page.state.general.plussData,
    previousPageView: page.state.general.previousPageView,
    type: 'pageLoad',
    scroll: {
      scrollHeight: page.state.general.scrollHeight,
    },
  };
}
