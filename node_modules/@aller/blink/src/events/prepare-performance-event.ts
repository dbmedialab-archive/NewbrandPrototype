import generalData from '../utils/general-data';
import getIdFromUrl from '../utils/get-id-from-url';

import { BlinkEvent } from '../types';
import { PerformanceTimings } from '../main';
import { Page } from '../selectors/get-page-state';

export interface PreparePerformanceInput {
  page: Page;
  performanceTimings: PerformanceTimings;
}

export default function preparePerformanceEvent({
  page,
  performanceTimings,
}: PreparePerformanceInput): BlinkEvent {
  const { url, site } = page.state.general;
  const id = getIdFromUrl(url, site);

  return {
    ...generalData(page.state),
    id: id || '',
    performanceTimings,
    type: 'performance',
  };
}
