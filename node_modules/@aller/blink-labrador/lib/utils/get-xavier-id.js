"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var uuid_1 = __importDefault(require("./uuid"));
var cookie_utils_1 = require("./cookie-utils");
var xavierId = '';
function getXavierId(docu, nocache, now, getUUID, cachedId) {
    if (nocache === void 0) { nocache = false; }
    if (now === void 0) { now = new Date(); }
    if (getUUID === void 0) { getUUID = uuid_1.default; }
    if (cachedId === void 0) { cachedId = xavierId; }
    if (!docu && typeof document === 'undefined') {
        return 'xavier_no_doc';
    }
    var doc = docu || document;
    // Return opt-out ID (xavier_no) for users who do not want to be tracked
    if (cookie_utils_1.getCookie(doc || document, 'xavier_no')) {
        return 'xavier_no';
    }
    // Fetch id from cache if we have it
    if (cachedId && !nocache) {
        return cachedId;
    }
    // Fetch id from cookie if we have it
    xavierId = cookie_utils_1.getCookie(doc, 'xavier');
    if (xavierId) {
        cookie_utils_1.setCookie(doc, 'xavier', xavierId, now);
        return xavierId;
    }
    // Generate a new id and store it
    xavierId = getUUID('xavierId');
    cookie_utils_1.setCookie(doc, 'xavier', xavierId, now);
    return xavierId;
}
exports.default = getXavierId;
//# sourceMappingURL=get-xavier-id.js.map