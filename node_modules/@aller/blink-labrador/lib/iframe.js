"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var uuid_1 = __importDefault(require("./utils/uuid"));
var subscribe_to_jw_1 = require("./utils/subscribe-to-jw");
function getPlayer(id) {
    var jwplayer = window['jwplayer'];
    return jwplayer && jwplayer(id);
}
function trackVideos(selector) {
    if (selector === void 0) { selector = '[data-videoid]'; }
    var videoNodes = document.querySelectorAll(selector);
    var _loop_1 = function (i) {
        var videoId = videoNodes[i].dataset.videoid;
        var canBeSticky = videoNodes[i].dataset.sticky == 'true';
        var playerId = uuid_1.default(videoId);
        var player = getPlayer(videoId);
        var trackEvent = function (ev) {
            window.top.postMessage(ev, '*');
        };
        if (player && player.getDuration() !== undefined) {
            subscribe_to_jw_1.subscribeToJW(trackEvent, player, playerId, canBeSticky);
        }
        else {
            window.addEventListener("playerLoaded-" + videoId, function () {
                subscribe_to_jw_1.subscribeToJW(trackEvent, getPlayer(videoId), playerId, canBeSticky);
            });
        }
    };
    for (var i = 0; i < videoNodes.length; i++) {
        _loop_1(i);
    }
}
exports.trackVideos = trackVideos;
//# sourceMappingURL=iframe.js.map